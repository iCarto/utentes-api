{% extends "base.jinja2" %}
{% block css_assets %}
    {% assets
    "vendor/leaflet-1.6.0/leaflet.css",
    "vendor/leaflet-geoman-2.6.0/leaflet-geoman.css",
    "lib/backbone-dms/css/backbone-dms.css",
    "offline/sixhiara-labels.css",
    "vendor/Leaflet.fullscreen-1.0.2/leaflet.fullscreen.css",
    "css/exploracao-show.css",
    "css/alert-system.css",
    "css/base.css",
    output="dist/exploracao-show.css", filters="cssrewrite,cssutils" %}
        <link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}">
    {% endassets %}

    {% assets
    "lib/leaflet-table/src/leaflet-table.css",
    "lib/leaflet-table/vendor-hacked/leaflet-toolbar-0.4.0-alpha.2/leaflet.toolbar-src.css",
    output="dist/myleaflettable.css", filters="cssrewrite,cssutils" %}
          <link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}">
    {% endassets %}

{% endblock css_assets %}
{% block main_block %}
    <main>
      <div id="license-info" class="row"></div>
      <section class="row">
        <section id="block-title" class="col-xs-12">
          <h3>
            <button id="delete-button" type="button" class="btn btn-default btn-sm uilib-enability uilib-show-role-administrador">Eliminar</button>
            <button id="file-modal" type="button" class="btn btn-default btn-sm">Documentação</button>
            <button id="refresh-button" type="button" class="btn btn-default btn-sm uilib-enability uilib-hide-role-observador">Refrescar</button>
            <button id="save-button" type="button" class="btn btn-primary btn-sm uilib-enability uilib-show-role-administrador uilib-show-role-tecnico uilib-show-role-juridico">Gravar</button>
            {% if next_state == 'Utente de usos comuns' %}
            <button id="licenciar-button" type="button" class="btn btn-primary btn-sm uilib-enability uilib-show-role-administrador uilib-show-role-juridico" style="float: right;">Licenciar</button>
            {% endif %}
          </h3>
        </section>
      </section>
      <section id="intro-section" class="row">
        <section id="map-section" class="col-xs-6">
            <div id="map" class="col-xs-12"></div>
        </section>
        <section id="info-section" class="col-xs-6">
          <section id="block-info">
            <div class="row">
              <h3 class="col-xs-1"><i class="fas fa-info"></i></h3>
              <h3 class="col-xs-11 exploracao_info">
                <span class="widget" id="exp_id"></span>
                <span class="widget" id="exp_name"></span>
                <button type="button" class="btn btn-default btn-xs pull-right uilib-enability uilib-show-role-administrador uilib-show-role-tecnico uilib-show-role-juridico" id="editBlockInfo">Editar</button>
              </h3>
            </div>
            {% if request.registry.settings.get("ara") != 'DPMAIP' and next_state != 'Utente de usos comuns' %}
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
              <span class="label widget" id="summary_licencia_msg"></span>
              <span class="label widget" id="summary_consumo_msg"></span>
              </span>
            </div>
            <br>
            {% endif %}
            {% if request.registry.settings.get("ara") != 'DPMAIP' %}
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
                  <span class="title">{{ d_soli_label }}:</span> <span class="widget-date" id="d_soli">-</span>
                  <span class="title">Número do cadastro unificado:</span> <span class="widget" id="cadastro_uni">-</span>
              </span>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
                  <span class="title">Número do título:</span> <span class="widget" id="d_titulo">-</span>
                  <span class="title">Número do processo:</span> <span class="widget" id="d_proceso">-</span>
                  <span class="title">Número de folha:</span> <span class="widget" id="d_folha">-</span>
              </span>
            </div>
            <div class="row">
                <span class="col-xs-offset-1 col-xs-11">
                    <span class="title">Número de parcela:</span> <span class="widget" id="d_parcela">-</span>
                    <span class="title">Área (ha):</span> <span class="widget-number" id="d_area">-</span>
                    <span class="title">Data de emissão :</span> <span class="widget-date" id="d_d_emis">-</span>
                    <span class="title">Local de emissão:</span> <span class="widget" id="d_l_emis">-</span>
                </span>
            </div>

            {% endif %}
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
                  <span class="title">Observações:</span> <span class="widget" id="observacio">-</span>
              </span>
            </div>
            <br>
          </section>
          <section id="block-location">
            <div class="row">
              <h3 class="col-xs-1"><i class="fas fa-map-marker-alt"></i></h3>
              <h3 class="col-xs-11"><span class="widget" id="loc_provin"></span> / <span class="widget" id="loc_distri"></span>
                <button type="button" class="btn btn-default btn-xs pull-right uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="editBlockLocation">Editar</button>
              </h3>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Posto:</span> <span class="widget" id="loc_posto">-</span> <span class="title">Bairro:</span> <span class="widget" id="loc_nucleo">-</span> <span class="title"> Endereço:</span> <span class="widget" id="loc_endere">-</span>
              </span>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
              {% if request.registry.settings.get("ara") != 'DPMAIP' %}
              <span class="title">Unidade:</span> <span class="widget" id="loc_unidad">-</span>
              {% endif %}
              <span class="title">Bacia:</span> <span class="widget" id="loc_bacia">-</span>
              <span class="title">Sub-bacia:</span> <span class="widget" id="loc_subaci">-</span>
              <span class="title">Río:</span> <span class="widget" id="loc_rio">-</span>
              </span>
            </div>
            <br>
          </section>
          <section id="block-utente">
            <div class="row">
              <h3 class="col-xs-1"><i class="fas fa-user"></i></h3>
              <h3 class="col-xs-11">
                <span class="widget" id="nome"></span>
                <button type="button" class="btn btn-default btn-xs pull-right uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="editBlockUtente">Editar</button>
              </h3>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Tipo de utente:</span> <span class="widget" id="uten_tipo">-</span><span class="title"> NUIT:</span> <span class="widget" id="nuit">-</span>
              </span>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
                  <span class="title">Nome do gerente/presidente:</span> <span class="widget" id="uten_gere">-</span>
                  <span class="title">Número de membros:</span> <span class="widget" id="uten_memb">-</span>
                  <span class="title">Número de mulheres:</span> <span class="widget" id="uten_mulh">-</span>
              </span>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
                  <span class="title"> Pessoa de Contacto:</span> <span class="widget" id="contacto">-</span>
                  <span class="title">Email:</span> <span class="widget" id="email">-</span>
                  <span class="title"> Telefone:</span> <span class="widget" id="telefone">-</span>
              </span>
            </div>

            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
                  <span class="title">BI / Dire / Passaporte:</span> <span class="widget" id="bi_di_pas">-</span>
                  <span class="title">Data de emissão:</span> <span class="widget-date" id="bi_d_emis">-</span>
                  <span class="title">Local de emissão:</span> <span class="widget" id="bi_l_emis">-</span>
              </span>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Número de Registo Comercial:</span> <span class="widget" id="reg_comerc">-</span>
              <span class="title">Local do registro:</span> <span class="widget" id="reg_zona">-</span>
              </span>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Localização:</span> <span class="widget" id="loc_provin">-</span> <span class="title">/</span> <span class="widget" id="loc_distri">-</span> <span class="title">/</span> <span class="widget" id="loc_posto">-</span> <span class="title">/</span> <span class="widget" id="loc_nucleo">-</span> <span class="title">/</span> <span class="widget" id="loc_endere">-</span>
              </span>
            </div>
            <div class="row">
              <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Observações:</span> <span class="widget" id="observacio">-</span>
              </span>
            </div>
          </section>
        </section>
      </section>
      {% if request.registry.settings.get("ara") != 'DPMAIP' %}
      <section id="block-consumos" class="row text-center">
        {% if next_state != 'Utente de usos comuns' %}
        <div class="col-xs-3">
          <div class="" style="display: inline-block; font-weight: bolder; padding-right: 5px;">
            <h3 style="font-weight: bolder;">
              <span class="widget-number" id="c_licencia">-</span>
            </h3>
            <span>LICENCIADOS</span>
          </div>
          <div id="div-summary_pago_iva">
            <h3>
              <span class="widget-number" id="summary_pago_iva">-</span>
            </h3>
            <span>MT/mês com IVA</span>
          </div>
        </div>
        {% endif %}
        {% if next_state != 'Utente de usos comuns' %}
        <div class="col-xs-3">
        {% else %}
        <div class="col-xs-4">
        {% endif %}
          <h3><span class="widget-number" id="c_soli">-</span> </h3>
          <span>SOLICITADOS</span>
        </div>
        {% if next_state != 'Utente de usos comuns' %}
        <div class="col-xs-3">
          <h3><span class="widget-number" id="c_real">-</span> </h3>
          <span>REAIS</span>
        </div>
        {% else %}
        <div class="col-xs-4" style="font-weight: bolder;">
          <h3 style="font-weight: bolder;"><span class="widget-number" id="c_real">-</span> </h3>
          <span>REAIS</span>
        </div>
        {% endif %}

        {% if next_state != 'Utente de usos comuns' %}
        <div class="col-xs-3">
        {% else %}
        <div class="col-xs-4">
        {% endif %}
          <h3><span class="widget-number" id="c_estimado">-</span> </h3>
          <span>ESTIMADOS</span>
        </div>
      </section>
      {% endif %}
      <section id="block-activity">
        <div class="row">
          <div class="col-xs-6">
            <div class="row">
              <h3 class="col-xs-1"><i class="fas fa-wrench"></i></h3>
              <h3 class="col-xs-11">
                Actividade: <span class="widget" id="actividade">Actividade non declarada</span>
                <button type="button" class="btn btn-default btn-xs uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="editActividade">Editar</button>
              </h3>
            </div>
          </div>
        </div>
        <div id="actividade-render">
          <!-- each activity needs to render itself here, so it needs to declare as many divs.row component as it needs -->
        </div>
      </section>
      <section class="row">
        <div class="col-xs-6">
          <div class="row">
            {% if request.registry.settings.get("ara") != 'DPMAIP' and next_state != 'Utente de usos comuns' %}
            <h3 class="col-xs-1"><i class="fas fa-tint"></i></h3>
            <h3 class="col-xs-11">Licenças e fontes</h3>
            {% else %}
            <h3 class="col-xs-1"><i class="fas fa-water"></i></h3>
            <h3 class="col-xs-11">Consumos e fontes</h3>
            {% endif %}
          </div>
        </div>
      </section>
      {% if request.registry.settings.get("ara") != 'DPMAIP' %}
      <section class="row">
        <div class="col-xs-6" id="block-subterranea">-</div>
        <div class="col-xs-6" id="block-superficial">-</div>
      </section>
      {% else %}
      <section id="block-consumos" class="row">
        <div class="col-xs-offset-1 col-xs-1">
          <div class="row">
            <h4>Licenciados</h4>
          </div>
          <h3><span class="widget-number" id="c_licencia">-</span></h3>
        </div>
        <div class="col-xs-1" style="border-right: 1px solid grey;">
          <div class="row">
            <h4>Solicitados</h4>
          </div>
          <h3><span class="widget-number" id="c_soli">-</span> </h3>
        </div>
        <div class="col-xs-offset-1 col-xs-3" id="block-superficial">-</div>
        <div class="col-xs-3" id="block-subterranea">-</div>
      </section>
      {% endif %}
      <section class="row">
        <div class="col-xs-12">
          <table class="table table-bordered" id="block-fontes">
            <thead>
              <tr>
                <th style="width: 7%;">Tipo de água</th>
                <th style="width: 7%;">Tipo de fonte</th>
                <th style="width: 12%;">Consumo solicitado <i class="units">(m<sup>3</sup>/mês)</i></th>
                {% if request.registry.settings.get("ara") != 'DPMAIP' %}
                <th style="width: 10%;">Consumo real <i class="units">(m<sup>3</sup>/mês)</i></th>
                {% endif %}
                <th style="width: 8%;">Toma de dados</th>
                <th style="width: 12%;">Número de catastro</th>
                <th style="width: 12%;">Lat / Lon</th>
                <th style="width: 25%;" class="observacio">Observações</th>
                <th style="width: 2%;" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                <th style="width: 2%;" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </main>
    <!-- TEMPLATES -->
    {% import 'exploracao_show_macros.jinja2' as exploracao_show_macros with context%}
    {% include 'exploracao-show-modal-info-block.jinja2' %}
    <!-- tmpl block location modal -->
    <script type="text/template" id="block-location-modal-tmpl">
      <div class="modal fade" id="editLocModal" tabindex="-1" role="dialog" aria-labelledby="editLocModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Pechar"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="editLocModalLabel">Exploração</h4>
            </div>
            <div class="modal-body">
              <div class="row panel-equal-height">
                <div class="col-xs-offset-1 col-xs-5">
                  <div class="panel panel-info">
                    <div class="panel-heading">
                      <h3 class="panel-title"><strong>Localização</strong></h3>
                    </div>
                    <div class="panel-body">
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                            <label for="loc_provin">Província</label>
                            <select class="form-control widget" id="loc_provin"></select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_distri">Distrito</label>
                              <select class="form-control widget" id="loc_distri"></select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_posto">Posto administrativo</label>
                              <select class="form-control widget" id="loc_posto"></select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_nucleo">Bairro</label>
                              <input type="text" class="form-control widget" id="loc_nucleo">
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_endere">Endereço</label>
                              <textarea class="form-control widget" id="loc_endere" rows="4"></textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-xs-5">
                  <div class="panel panel-info">
                    <div class="panel-heading">
                      <h3 class="panel-title"><strong>Localização hidrologica</strong></h3>
                    </div>
                    <div class="panel-body">
                      {% if request.registry.settings.get("ara") != 'DPMAIP' %}
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_unidad">Unidade</label>
                              <select class="form-control widget" id="loc_unidad"></select>
                          </div>
                        </div>
                      </div>
                      {% endif %}
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_bacia">Bacia</label>
                              <select class="form-control widget" id="loc_bacia"></select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_subaci">Sub-bacia</label>
                              <select class="form-control widget" id="loc_subaci"></select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-xs-12">
                          <div class="form-group">
                              <label for="loc_rio">Rio</label>
                              <input type="text" class="form-control widget" id="loc_rio">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {{exploracao_show_macros.modal_footer()}}
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl block utente modal -->
    {% include 'utente-modal-template.jinja2' %}

    <!-- modal for actividades -->
    <script type="text/template" id="modal-actividades">
      <div class="modal fade" id="editActividadeModal" tabindex="-1" role="dialog" aria-labelledby="editActividadeModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Pechar"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="editActividadeModalLabel">Actividade</h4>
            </div>
            <div class="modal-body">
              {% if request.registry.settings.get("ara") != 'DPMAIP' %}
              <div id="actividade-explotacion" class="row">
                <div class="form-group col-xs-offset-1 col-xs-10">
                  <label for="actividade">Tipo de actividade</label>
                  <select id="tipo" class="form-control widget"></select>
                </div>
              </div>
              {% endif %}

              <div id="actividade-render-modal"></div>
            </div>
            {{exploracao_show_macros.modal_footer()}}
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl no activity -->
    <script type="text/template" id="Actividade non declarada"></script>
    <!-- template no activity (inside modal) -->
    <script type="text/template" id="Actividade non declarada_edit">
      <input type="hidden" id="id">
    </script>
    <!-- tmpl actividade abastecimento -->
    <script type="text/template" id="Abastecimento">
      <div class="row">
        <span class="col-xs-6">
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i>:</span> <span><%- formatter().formatNumber(c_estimado) || '-' %></span>
              <span class="title">Dotaçâo <i class="units">(l/pessoa/dia)</i>:</span> <span><%- formatter().formatNumber(dotacao) || '-' %></span>
            </span>
          </div>
        </span>
      </div>
      <div class="row">
        <span class="col-xs-offset-1 col-xs-11"></span>
      </div>
    </script>
    <!-- tmpl actividade abastecimento (inside modal) -->
    <script type="text/template" id="Abastecimento_edit">
      <input type="hidden" id="id">
      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Dados de cálculo do consumo estimado</strong></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="form-group col-xs-6">
                  <label for="habitantes">Número de habitantes (Utilizadores)</label>
                  <input type="text" class="form-control widget-number" id="habitantes" pattern="[0-9]{1,8}([,][0-9]{1,2})?" required>
                </div>
                <div class="form-group col-xs-6">
                  <label for="dotacao">Dotaçâo <i class="units">(l/pessoa/dia)</i></label>
                  <input type="text" class="form-control widget-number" id="dotacao" value="20" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade agricultura -->
    <script type="text/template" id="Agricultura de Regadio">
      <div id="block-regadia">

        <div class="row">
          <span class="col-xs-offset-1 col-xs-11">
            <div class="col-xs-3">
              <div class="row">
                <span class="title">Área potencial:</span> <span><%- formatter().formatNumber(area_pot) || '-' %></span>
              </div>
              <div class="row">
                <span class="title">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i>:</span> <span><%- formatter().formatNumber(c_estimado) || '-' %></span>
              </div>
            </div>
            <div class="col-xs-3">
              <div class="row">
                <span class="title">Área irrigada:</span> <span><%- formatter().formatNumber(area_irri) || '-' %></span>
              </div>
              <div class="row">
                <span class="title">Número de culturas:</span> <span><%- formatter().formatNumber(n_cul_tot) || '-' %></span>
              </div>
            </div>
            <div class="col-xs-3">
              <div class="row">
                <span class="title">Área medida:</span> <span><%- formatter().formatNumber(area_medi) || '-' %></span>
              </div>
            </div>
            <div class="col-xs-3">
            </div>
          </span>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <div class="form-group">
              <button class="btn btn-default pull-right uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="newRow">Nova cultura</button>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <table class="table table-bordered" id="cultivos">
              <thead>
                <tr>
                  <th style="width:14%">Id</th>
                  <th style="width:14%">Consumo Estimado <i class="units">(m<sup>3</sup>/mês)</i></th>
                  <th style="width:14%">Tipo de cultura / rega</th>
                  <th style="width:14%">Eficiência da rega</th>
                  <th style="width:14%">Área <i class="units">(ha)</i></th>
                  <th>Observações</th>
                  <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                  <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                  <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade agricultura (inside modal)-->
    <script type="text/template" id="Agricultura de Regadio_edit">
      <input type="hidden" id="id">

      <div class="row">
        <div class="col-xs-offset-1 col-xs-8">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Dados gerais</strong></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="form-group col-xs-4">
                  <label for="area_pot">Área potencial</label>
                  <input type="text" class="form-control widget-number" id="area_pot">
                </div>
                <div class="form-group col-xs-4">
                  <label for="area_irri">Área irrigada</label>
                  <input type="text" class="form-control widget-number" id="area_irri">
                </div>
                <div class="form-group col-xs-4">
                  <label for="area_medi">Área medida</label>
                  <input type="text" class="form-control widget-number" id="area_medi">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-xs-4">
                  <label for="n_cul_tot">Número de culturas</label>
                  <input type="text" class="form-control widget-number" id="n_cul_tot" disabled>
                </div>
              </div>

            </div>
          </div>
        </div>

        <div class="col-xs-2">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Consumos</strong></h3>
            </div>
            <div class="panel-body" id="panel-body-regadio-consumos">
              <div class="form-group">
                <label for="c_estimado">C. estimado <i class="units">(m<sup>3</sup>/mês)</i></label>
                <input type="text" class="form-control widget-number" id="c_estimado" disabled>
              </div>
            </div>
          </div>
        </div>
      </div>

    </script>
    <!-- modal engadir cultivo -->
    <script type="text/template" id="cultivoModalTpl">
      <div class="modal fade" id="cultivoModal" tabindex="-1" role="dialog" aria-labelledby="cultivoModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Pechar"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="cultivoModalLabel">Cultura</h4>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-xs-offset-1 col-xs-10">
                  <div class="panel panel-info">
                    <div class="panel-heading">
                      <h3 class="panel-title"><strong>Dados de cálculo do consumo estimado</strong></h3>
                    </div>
                    <div class="panel-body">
                      <div class="row">
                        <div class="form-group col-xs-6">
                          <label for="cultivo">Tipo de cultura</label>
                          <select class="form-control widget" id="cultivo"></select>
                        </div>
                        <div class="form-group col-xs-6">
                          <label for="rega">Tipo de rega</label>
                          <select class="form-control widget" id="rega"></select>
                        </div>
                      </div>
                      <div class="row">
                        <div class="form-group col-xs-6">
                          <label for="eficiencia">Eficiência da rega</label>
                          <input type="text" class="form-control widget-number" id="eficiencia" pattern="[0-9]{1,8}([,][0-9]{1,2})?" />
                        </div>
                        <div class="form-group col-xs-6">
                          <label for="area">Área <i class="units">(ha)</i></label>
                          <input type="text" class="form-control widget-number" id="area" pattern="[0-9]{1,8}([,][0-9]{1,4})?" required />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="form-group col-xs-12">
                      <label for="observacio">Observaçôes</label>
                      <textarea class="form-control widget" id="observacio" rows="4"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <div class="row">
                <div class="col-xs-offset-1 col-xs-10">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                  <button type="button" class="btn btn-primary" id="okButton">Aceitar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade industria -->
    <script type="text/template" id="Indústria">
      <div class="row">
        <div class="col-xs-6">
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i>:</span> <span><%- formatter().formatNumber(c_estimado) || '-' %></span>
              <span class="title">Tipo de indústria:</span> <span><%- tipo_indus || '-' %></span>
            </span>
          </div>
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Evaluação de Impacto Ambiental:</span> <span><%- eval_impac === true ? 'Sim' : ( eval_impac === false ? 'Não' : '-') %></span>
            </span>
          </div>
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Instalaçôes:</span> <span><%- instalacio || '-' %></span>
            </span>
          </div>
        </div>
        <div class="col-xs-6">
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Efluente:</span> <span><%- efluente || '-' %></span>
            </span>
          </div>
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Méios de tratamento da água:</span> <span><%- tratamento || '-' %></span>
            </span>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade industria (inside modal) -->
    <script type="text/template" id="Indústria_edit">
      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Dados gerais</strong></h3>
            </div>
            <div class="panel-body">
              <input type="hidden" id="id">
              <div class="col-xs-5">
                <div class="row">
                  <div class="form-group">
                    <label for="tipo_indus">Tipo de indústria</label>
                    <select class="form-control widget" id="tipo_indus"></select>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label for="tratamento">Méios de tratamento da água</label>
                    <textarea class="form-control widget" id="tratamento" rows="4"></textarea>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label for="instalacio">Instalaçôes</label>
                    <textarea class="form-control widget" id="instalacio" rows="4"></textarea>
                  </div>
                </div>
              </div>
              <div class="col-xs-offset-1 col-xs-6">
                <div class="row">
                  <div class="form-group">
                    <label for="eval_impac">Evaluação de Impacto Ambiental</label>
                    <select class="form-control widget-boolean" id="eval_impac"></select>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label for="efluente">Efluente produzido</label>
                    <textarea class="form-control widget" id="efluente" rows="4"></textarea>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Consumos</strong></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="form-group col-xs-6">
                  <label for="c_estimado">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i></label>
                  <input type="text" class="form-control widget-number" id="c_estimado" pattern="[0-9]{1,8}([,][0-9]{1,2})?" required>
                </div>
                <div class="form-group col-xs-6">
                  <label for="c_estimado_computed">Consumo autocalculado <i class="units">(m<sup>3</sup>/mês)</i></label>
                  <input type="text" class="form-control" id="c_estimado_computed" disabled>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade pecuaria -->
    <script type="text/template" id="Pecuária">
      <div id="block-pecuaria">

        <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <div class="col-xs-3">
                <div class="row">
                  <span class="title">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i>:</span> <span><%- formatter().formatNumber(c_estimado) || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Número de reses total:</span> <span><%- formatter().formatNumber(n_res_tot) || '-' %></span>
                </div>
              </div>
              <div class="col-xs-3">
              </div>
              <div class="col-xs-3">
              </div>
              <div class="col-xs-3">
              </div>
            </span>
        </div>

        <div class="row">
          <div class="col-xs-12">
            <div class="form-group">
              <button class="btn btn-default pull-right uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="newRow">Nova res</button>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-12">
            <table class="table table-bordered" id="reses">
              <thead>
                <tr>
                  <th style="width:20%">Consumo Estimado <i class="units">(m<sup>3</sup>/mês)</i></th>
                  <th style="width:20%">Tipo de reses</th>
                  <th style="width:20%">Número de reses</th>
                  <th>Observações</th>
                  <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                  <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade pecuaria (inside modal) -->
    <script type="text/template" id="Pecuária_edit">
      <input type="hidden" id="id">
      <div class="row">
        <div class="col-xs-offset-1 col-xs-8">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Dados gerais</strong></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="form-group col-xs-4">
                  <label for="n_res_tot">Número de reses total</label>
                  <input type="text" class="form-control widget-number" id="n_res_tot" disabled>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xs-2">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Consumos</strong></h3>
            </div>
            <div class="panel-body">
              <div class="form-group">
                <label for="c_estimado">C. estimado <i class="units">(m<sup>3</sup>/mês)</i></label>
                <input type="text" class="form-control widget-number" id="c_estimado" disabled>
              </div>
            </div>
          </div>
        </div>

      </div>
    </script>
    <!-- modal engadir res -->
    <script type="text/template" id="resModalTpl">
      <div class="modal fade" id="resModal" tabindex="-1" role="dialog" aria-labelledby="resModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Pechar"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="resModalLabel">Res</h4>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-xs-offset-1 col-xs-10">
                  <div class="panel panel-info">
                    <div class="panel-heading">
                      <h3 class="panel-title"><strong>Dados de cálculo do consumo estimado</strong></h3>
                    </div>
                    <div class="panel-body">
                      <div class="row">
                        <div class="form-group col-xs-6">
                          <label for="reses_tipo">Tipo de reses</label>
                          <select class="form-control widget" id="reses_tipo"></select>
                        </div>
                        <div class="form-group col-xs-6">
                          <label for="reses_nro">Número de reses</label>
                          <input type="text" class="form-control widget-number" id="reses_nro" pattern="[0-9]{1,8}([,][0-9]{1,2})?" required />
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="form-group col-xs-12">
                      <label for="observacio">Observaçôes</label>
                      <textarea class="form-control widget" id="observacio" rows="4"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <div class="row">
                <div class="col-xs-offset-1 col-xs-10">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                  <button type="button" class="btn btn-primary" id="okButton">Aceitar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade piscicultura -->
    <script type="text/template" id="Piscicultura">
      <div class="row">
        <div class="col-xs-12">
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <div class="col-xs-3">
                {% if request.registry.settings.get("ara") != 'DPMAIP' %}
                <div class="row">
                  <span class="title">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i>:</span> <span><%- formatter().formatNumber(c_estimado) || '-' %></span>
                </div>
                {% endif %}
                <div class="row">
                  <span class="title">Área de exploraçaõ <i class="units">(ha)</i>:</span> <span><%- formatter().formatNumber(area) || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Ano de inicio da actividade:</span> <span><%- ano_i_ati || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Tipo de aquacultura:</span> <span><%- tipo_aqua || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Espécies cultivadas:</span> <span><%- esp_culti || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Número de tanques/gaiolas:</span> <span><%- n_tanques || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Volume total dos tanques/gaiolas (Reservas) <i class="units">(m<sup>3</sup>)</i>:</span> <span><%- formatter().formatNumber(v_reservas) || '-' %></span>
                </div>
              </div>
              <div class="col-xs-3">
                <div class="row">
                  <span class="title">Proveniência dos alevinos:</span> <span><%- prov_alev || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Número de alevines povoados:</span> <span><%- n_ale_pov || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Producção anual <i class="units">(kg)</i>:</span> <span><%- produc_pi || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Processamento do peixe:</span> <span><%- tipo_proc || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Durante a abertura dos tanques/gaiolas:</span> <span><%- asis_aber || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Na monitoria dos tanques/gaiolas:</span> <span><%- asis_moni || '-' %></span>
                </div>
              </div>
              <div class="col-xs-3">
                <div class="row">
                  <span class="title">Origem da assistência :</span> <span><%- asis_orig || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Origem (Outros) :</span> <span><%- asis_or_o || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Tratamento da água que entra nos tanques :</span> <span><%- trat_t_en || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Tratamento da água que sai dos tanques :</span> <span><%- trat_a_sa || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">As gaiolas estão submersas em :</span> <span><%- gaio_subm || '-' %></span>
                </div>
              </div>
              <div class="col-xs-3">
                <div class="row">
                  <span class="title">A exploraçaõ tem problemas :</span> <span><%- problemas || '-' %></span>
                </div>
                <div class="row">
                  <span class="title">Principais problemas :</span> <span><%- prob_prin || '-' %></span>
                </div>
              </div>
            </span>
          </div>
          <div class="row">
              <div class="col-xs-12">
                <div class="form-group">
                  <button class="btn btn-default pull-right uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="newRow">Novo tanque</button>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-12">
                <table class="table table-bordered" id="tanques">
                  <thead>
                    <tr>
                      <th>Id</th>
                      <th>Tipo</th>
                      <th>Volume <i class="units">(m<sup>3</sup>/mês)</i></th>
                      <th>Estado</th>
                      <th>Espécie cultivada</th>
                      <th>Tipo de alimentação</th>
                      <th>Número de alevinos povoados</th>
                      <th>Producção anual <i class="units">(Kg)</i></th>
                      <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                      <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                      <th style="width:2%" class="uilib-enability uilib-show-role-administrador uilib-show-role-tecnico"></th>
                    </tr>
                  </thead>
                  <tbody>
                  </tbody>
                </table>
              </div>
            </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade piscicultura-->
    <script type="text/template" id="Piscicultura_edit">
      <input type="hidden" id="id">

        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Dados gerais</strong></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="form-group col-xs-4">
                  <label for="ano_i_ati">Ano de inicio da actividade</label>
                  <input type="text" class="form-control widget-number" id="ano_i_ati" pattern="[0-9]{4}">
                </div>
                <div class="form-group col-xs-4">
                  <label for="tipo_proc">Processamento do peixe</label>
                  <select class="form-control widget" id="tipo_proc"></select>
                </div>
                <div class="form-group col-xs-4">
                  <label for="area">Área <i class="units">(ha)</i></label>
                  <input type="text" class="form-control widget-number" id="area" pattern="[0-9]{1,8}([,][0-9]{1,4})?">
                </div>

                <div class="form-group col-xs-4">
                    <label for="n_tanques">Número de tanques/gaiolas</label>
                    <input type="text" class="form-control widget-number" id="n_tanques" pattern="[0-9]*">
                </div>
                <div class="form-group col-xs-4">
                  <label for="v_reservas">Volume total dos tanques/gaiolas <i class="units">(m<sup>3</sup>)</i></label>
                  <input type="text" class="form-control widget-number" id="v_reservas" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                </div>
                <div class="form-group col-xs-4">
                  <label for="n_ale_pov">Número de alevinos povoados</label>
                  <input type="text" class="form-control widget-number" id="n_ale_pov" pattern="[0-9]*">
                </div>
                <div class="form-group col-xs-4">
                  <label for="produc_pi">Producção Anual <i class="units">(Kg)</i></label>
                  <input type="text" class="form-control widget-number" id="produc_pi" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                </div>
                <div class="form-group col-xs-4">
                  <label for="tipo_proc">Tipo de aquacultura</label>
                  <select class="form-control widget" id="tipo_aqua"></select>
                </div>
              </div>
              <div class="row">
              <hr>
              </div>
              <div class="row">
                  <div id="esp_culti" class="widget-external col-xs-12">
                      <label for="esp_culti">Espécies cultivadas</label>
                      <div class="row">
                          <div><label class="checkbox col-xs-1"><input type="checkbox" name="esp_culti" value="Carpa">Carpa</label></div>
                          <div><label class="checkbox col-xs-2"><input type="checkbox" name="esp_culti" value="Tainha">Tainha</label></div>
                          <div><label class="checkbox col-xs-3"><input type="checkbox" name="esp_culti" value="Tilapia mossambicus">Tilapia mossambicus</label></div>
                          <div><label class="checkbox col-xs-2"><input type="checkbox" name="esp_culti" value="Tilapia nilótica">Tilapia nilótica</label></div>
                          <div><label class="checkbox col-xs-2"><input type="checkbox" name="esp_culti" value="Outros">Outros</label></div>
                      </div>

                  </div>
              </div>
              <div class="row">
                  <hr>
              </div>
              <div class="row">
                  <div id="prov_alev" class="widget-external col-xs-12">
                      <label for="prov_alev">Proveniência dos alevines</label>
                      <div class="row">
                          <div><label class="checkbox col-xs-3"><input type="checkbox" name="prov_alev" value="Melhorados">Melhorados</label></div>
                          <div><label class="checkbox col-xs-3"><input type="checkbox" name="prov_alev" value="Reproducção nos tanques">Reproducção nos tanques</label></div>
                          <div><label class="checkbox col-xs-3"><input type="checkbox" name="prov_alev" value="Selvagens">Selvagens</label></div>
                          <div><label class="checkbox col-xs-3"><input type="checkbox" name="prov_alev" value="Outros">Outros</label></div>
                      </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
        {% if request.registry.settings.get("ara") != 'DPMAIP' %}
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Consumos</strong></h3>
            </div>
            <div class="panel-body">
              <div class="form-group">
                <label for="c_estimado">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i></label>
                <input type="text" class="form-control widget-number" id="c_estimado" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
              </div>
            </div>
          </div>
        </div>
        {% endif %}


      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Assistência técnica</strong></h3>
            </div>
            <div class="panel-body">
              <div class="col-xs-4">
                <div class="row">
                  <div class="form-group">
                    <label for="asis_aber">Durante a abertura dos tanques/gaiolas</label>
                    <select class="form-control widget" id="asis_aber"></select>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label for="asis_moni">Na monitoria dos tanques/gaiolas</label>
                    <select class="form-control widget" id="asis_moni"></select>
                  </div>
                </div>
              </div>
              <div class="col-xs-8">
                <div id="asis_orig" class="widget-external">
                  <label class="col-xs-offset-1" for="asis_orig">Origem da assistência técnica</label>
                  <div class="row">
                    <div><label class="checkbox col-xs-offset-1 col-xs-3"><input type="checkbox" name="asis_orig" value="SDAE">SDAE</label></div>
                    <div><label class="checkbox col-xs-offset-1 col-xs-3"><input type="checkbox" name="asis_orig" value="DPMAIP-CD">DPMAIP-CD</label></div>
                    <div><label class="checkbox col-xs-offset-1 col-xs-3"><input type="checkbox" name="asis_orig" value="IDEPA">IDEPA</label></div>
                  </div>
                  <div class="row">
                    <div><label class="checkbox col-xs-offset-1 col-xs-3"><input type="checkbox" name="asis_orig" value="Outros">Outros</label></div>
                    <div class="form-group col-xs-offset-1 col-xs-6">
                      <input type="text" class="form-control widget" id="asis_or_o" disabled/>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Aspectos ambientais</strong></h3>
            </div>
            <div class="panel-body">
              <div class="row">
                <div class="form-group col-xs-4">
                  <label for="trat_t_en">Tratamento da água que entra nos tanques</label>
                  <select class="form-control widget" id="trat_t_en"></select>
                </div>
                <div class="form-group form-group col-xs-4">
                  <label for="trat_a_sa">Tratamento da água que sai dos tanques</label>
                  <select class="form-control widget" id="trat_a_sa"></select>
                </div>
                <div class="form-group form-group col-xs-4">
                  <label for="gaio_subm">As gaiolas estão submersas em</label>
                  <select class="form-control widget" id="gaio_subm"></select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Problemas</strong></h3>
            </div>
            <div class="panel-body">
              <div class="col-xs-3">
                <div class="row">
                  <div class="form-group">
                    <label for="problemas">A exploraçaõ tem problemas</label>
                    <select class="form-control widget" id="problemas"></select>
                  </div>
                </div>
              </div>
              <div class="col-xs-offset-1 col-xs-8">
                <div class="row">
                  <div class="form-group">
                    <label for="prob_prin">Principais problemas</label>
                    <textarea class="form-control widget" id="prob_prin" rows="3" disabled></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </script>
    <!-- tmpl actividade produccao energia -->
    <script type="text/template" id="Producção de energia">
      <div class="row">
        <div class="col-xs-6">
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i>:</span> <span><%- formatter().formatNumber(c_estimado) || '-' %></span>
              <span class="title">Tipo de producção:</span> <span><%- energia_tipo || '-' %></span>
            </span>
          </div>
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Altura de água:</span> <span><%-  formatter().formatNumber(alt_agua) || '-' %></span>
              <span class="title">Potência a instalar:</span> <span><%-  formatter().formatNumber(potencia) || '-' %></span>
            </span>
          </div>
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Evaluação de Impacto Ambiental:</span> <span><%- eval_impac === true ? 'Sim' : (eval_impac === false ? 'Não' : '-') %></span>
            </span>
          </div>
        </div>
        <div class="col-xs-6">
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Tipo de equipamento:</span> <span><%- equipo || '-' %></span>
            </span>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade produccao energia (inside modal) -->
    <script type="text/template" id="Producção de energia_edit">
      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <input type="hidden" id="id">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Dados gerais</strong></h3>
            </div>
            <div class="panel-body">
              <div class="col-xs-4">
                <div class="row">
                  <div class="form-group ">
                    <label for="energia_tipo">Tipo de producção</label>
                    <select class="form-control widget" id="energia_tipo"></select>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label for="alt_agua">Altura de água</label>
                    <input type="text" class="form-control widget-number" id="alt_agua" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label for="potencia">Potência a instalar</label>
                    <input type="text" class="form-control widget-number" id="potencia" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                  </div>
                </div>

              </div>
              <div class="col-xs-offset-1 col-xs-7">
                <div class="row">
                  <div class="form-group">
                    <label for="eval_impac">Evaluação de Impacto Ambiental</label>
                    <select class="form-control widget-boolean" id="eval_impac"></select>
                  </div>
                </div>
                <div class="row">
                  <div class="form-group">
                    <label for="equipo">Tipo de equipamento</label>
                    <textarea class="form-control widget" id="equipo" rows="4"></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-offset-1 col-xs-10">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h3 class="panel-title"><strong>Consumos</strong></h3>
            </div>
            <div class="panel-body">
              <div class="col-xs-4">
                <div class="row">
                  <div class="form-group">
                    <label for="c_estimado">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i></label>
                    <input type="text" class="form-control widget-number" id="c_estimado" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade saneamento -->
    <script type="text/template" id="Saneamento">
      <div class="row">
        <div class="col-xs-6">
          <div class="row">
            <span class="col-xs-offset-1 col-xs-11">
              <span class="title">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i>:</span> <span><%- formatter().formatNumber(c_estimado) || '-' %></span>
              <span class="title">Número de habitantes (Utilizadores):</span> <span><%- formatter().formatNumber(habitantes) || '-' %></span>
            </span>
          </div>
        </div>
      </div>
    </script>
    <!-- tmpl actividade saneamento (inside modal) -->
    <script type="text/template" id="Saneamento_edit">
      <input type="hidden" id="id">
      <div class="row">
          <div class="col-xs-offset-1 col-xs-5">
            <div class="panel panel-info">
              <div class="panel-heading">
                <h3 class="panel-title"><strong>Dados de cálculo do consumo estimado</strong></h3>
              </div>
              <div class="panel-body">
                <div class="row">
                  <div class="form-group col-xs-12">
                    <label for="habitantes">Número de habitantes (Utilizadores)</label>
                    <input type="text" class="form-control widget-number" id="habitantes" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xs-5">
            <div class="panel panel-info">
              <div class="panel-heading">
                <h3 class="panel-title"><strong>Consumos</strong></h3>
              </div>
              <div class="panel-body">
                <div class="row">
                  <div class="form-group col-xs-12">
                    <label for="c_estimado">Consumo estimado <i class="units">(m<sup>3</sup>/mês)</i></label>
                    <input type="text" class="form-control widget-number" id="c_estimado" pattern="[0-9]{1,8}([,][0-9]{1,2})?">
                  </div>
                </div>
              </div>
            </div>
          </div>
      </div>
    </script>
    <!-- block license modal tmpl -->
    <script type="text/template" id="block-license-modal-tmpl">
      <div class="modal fade" id="licenciaModal" tabindex="-1" role="dialog" aria-labelledby="licenciaModalLabel">
        {% if request.registry.settings.get("ara") != 'DPMAIP' and next_state != 'Utente de usos comuns' %}
        <div class="modal-dialog" role="document">
        {% else %}
        <div class="modal-dialog" role="document" style="width:600px!important; margin:30px auto!important">
        {% endif %}
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Pechar"><span aria-hidden="true">&times;</span></button>
              {% if request.registry.settings.get("ara") != 'DPMAIP' and next_state != 'Utente de usos comuns' %}
              <h4 class="modal-title" id="licenciaModalLabel">Licencia <%- tipo_agua %></span></h4>
              {% else %}
              <h4 class="modal-title" id="licenciaModalLabel">Consumo <%- tipo_agua === 'Subterrânea' ? 'Subterrâneo' : tipo_agua %></span></h4>
              {% endif %}
            </div>
            <div class="modal-body">
                <input type="hidden" id="tipo_agua">
                <input type="hidden" class="form-control widget" id="lic_nro">
              {% if request.registry.settings.get("ara") == 'DPMAIP' %}
              {{exploracao_show_macros.modal_licencia_dpmaip()}}
              {% elif next_state == 'Utente de usos comuns' %}
              {{exploracao_show_macros.modal_licencia_usos_comuns()}}
              {% else %}
              {{exploracao_show_macros.modal_licencia_general()}}
              {% endif %}
            </div>
            {{exploracao_show_macros.modal_footer()}}
          </div>
        </div>
      </div>
    </script>
    {% include 'exploracao-show-modal-fonte.jinja2' %}

    <!-- template licencia -->
    <script type="text/template" id="licencia-tmpl">
      <div class="panel">
        <div class="row">
          {% if request.registry.settings.get("ara") != 'DPMAIP' and next_state != 'Utente de usos comuns' %}
          <h4 class="col-xs-offset-1 col-xs-11">Licença <%- tipo_agua + ': ' %><span class="lic_nro"><%-(lic_nro || '-')%></span>
          {% else %}
          <h4 class="col-xs-offset-1 col-xs-11">Consumo <%- tipo_agua === 'Subterrânea' ? 'Subterrâneo' : tipo_agua %>
          {% endif %}
            <button type="button" class="btn btn-default btn-xs hidden uilib-enability uilib-show-role-administrador uilib-show-role-tecnico uilib-show-role-juridico" id="addLicense">Adicionar</button>
            <button type="button" class="btn btn-default btn-xs uilib-enability uilib-show-role-administrador uilib-show-role-tecnico uilib-show-role-juridico" id="editLicense">Editar</button>
            <button type="button" class="btn btn-default btn-xs uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="addFonte">Nova fonte</button>
            {% if request.registry.settings.get("ara") != 'DPMAIP' and next_state != 'Utente de usos comuns' %}
            <button type="button" class="btn btn-default btn-xs" id="showHistoric">Historico</button>
            <button type="button" class="btn btn-default btn-xs hidden uilib-enability uilib-show-role-administrador uilib-show-role-juridico" id="printLicense">Imprimir licença</button>
            {% endif %}
            <button type="button" class="btn btn-default btn-xs uilib-enability uilib-show-role-administrador uilib-show-role-tecnico" id="removeLicense">Eliminar</button>
          </h4>
        </div>

        {% if request.registry.settings.get("ara") != 'DPMAIP' %}
        <div class="row">
          <span class="col-xs-offset-1 col-xs-11">
            <span class="title">Estado:</span> <%- estado || '-' %> <i id="info-estado-licencia" class="fa fa-question-circle" style="cursor:pointer"></i>
          </span>
        </div>
        {% if next_state != 'Utente de usos comuns' %}
        <div class="row">
          <span class="col-xs-offset-1 col-xs-11">
            <span class="title">Número de licença histórico:</span> <%- n_licen_a || '-' %>
            <span class="title">Tipo de Licença:</span> <%- tipo_lic || '-' %>
          </span>
        </div>
        <div class="row">
          <span class="col-xs-offset-1 col-xs-11">
            <span class="title">Data de emissão:</span> <%- formatter().formatDate(d_emissao) || '-' %>
            <span class="title">Data de validade:</span> <%- formatter().formatDate(d_validade) || '-' %>
            <small id="info-license-block" class="info-pill <%- lic_time_over ? 'label-danger' : (lic_time_warning ? 'label-warning' : lic_time_enough ? 'label-success' : 'hidden') %>"> <%- lic_time_info!== null ? lic_time_info : 'Sem informação' %></small>
          </span>
        </div>
        <div class="row">
          <span class="col-xs-offset-1 col-xs-11">
            <span class="title">Valor de pago mensal <i class="units">(MT/mês)</i></span> <%- formatter().formatNumber(pago_mes) || '-' %>
            <span class="title">IVA <i class="units">(%)</i></span> <%- formatter().formatNumber(iva) || '-' %>
            <span class="title">Valor com IVA <i class="units">(MT/mês)</i></span> <%- formatter().formatNumber(pago_iva) || '-' %>
          </span>
        </div>
        <div class="row">
          <span class="col-xs-offset-1 col-xs-11">
            <span class="title">Taxa fixa <i class="units">(MT/mês)</i></span> <%- formatter().formatNumber(taxa_fixa) || '-' %>
            <span class="title">Taxa de uso <i class="units">(MT/m<sup>3</sup>)</i></span> <%- formatter().formatNumber(taxa_uso) || '-' %>
          </span>
        </div>


      <div class="row">
        <span class="col-xs-offset-1 col-xs-2 text-right"><%- formatter().formatNumber(consumo_fact) || '-' %> </span>
        <span class="col-xs-9">
          <span class="title"><i class="units">m<sup>3</sup>/mês</i> consumo facturado</span> <span class="title">(Tipo de facturação/consumo:</span> <span class="js_fact_tipo"></span> <span class="title">/</span> <%- consumo_tipo || '-' %><span class="title">)</span>
        </span>
      </div>
      <div class="row">
        <span class="col-xs-offset-1 col-xs-2 text-right"><%- formatter().formatNumber(c_licencia) || '-' %> </span>
        <span class="col-xs-9">
          <span class="title"><i class="units">m<sup>3</sup>/mês</i> consumo licenciado</span>
        </span>
      </div>
      {% endif %}
      <div class="row">
        <span class="col-xs-offset-1 col-xs-2 text-right"><%- formatter().formatNumber(c_real_tot) || '-' %> </span>
        <span class="col-xs-9">
          <span class="title"><i class="units">m<sup>3</sup>/mês</i> consumo real</span> <span class="title">(</span><%- formatter().formatNumber(c_real_int) || '-' %> <span class="title">intermedio /</span> <%- formatter().formatNumber(c_real_fon) || '-' %> <span class="title">fontes)</span>
        </span>
      </div>
      <div class="row">
        <span class="col-xs-offset-1 col-xs-2 text-right"><%- formatter().formatNumber(c_soli_tot) || '-' %> </span>
        <span class="col-xs-9">
          <span class="title"><i class="units">m<sup>3</sup>/mês</i> consumo solicitado</span> <span class="title">(</span><%- formatter().formatNumber(c_soli_int) || '-' %> <span class="title"> intermedio /</span> <%- formatter().formatNumber(c_soli_fon) || '-' %> <span class="title">fontes)</span>
        </span>
      </div>
      {% else %}
      <div class="row">
        <span class="col-xs-offset-1 col-xs-2 text-right"><%- formatter().formatNumber(c_licencia) || '-' %> </span>
        <span class="col-xs-9">
          <span class="title"><i class="units">m<sup>3</sup>/mês</i> consumo licenciado</span>
        </span>
      </div>
      <div class="row">
        <span class="col-xs-offset-1 col-xs-2 text-right"><%- formatter().formatNumber(c_soli_tot) || '-' %> </span>
        <span class="col-xs-9">
          <span class="title"><i class="units">m<sup>3</sup>/mês</i> consumo solicitado</span> <span class="title">(</span><%- formatter().formatNumber(c_soli_int) || '-' %> <span class="title"> intermedio /</span> <%- formatter().formatNumber(c_soli_fon) || '-' %> <span class="title">fontes)</span>
        </span>
      </div>
      {% endif %}
      </div>
    </script>

    {% include 'addcoordinatesmodalview_include.jinja2' %}
{% endblock main_block %}



{% block js_assets %}
<script src="/static/lib/docx-templates/docx-templates.js"></script>
<script src="/static/lib/jszip-utils/jszip-utils.js"></script>
    <!-- javascript -->



    {% assets
        "lib/moment-2.11.2/moment-with-locales.js",
        "vendor/leaflet-1.6.0/leaflet-src.js",
        "vendor/leaflet-geoman-2.6.0/leaflet-geoman.min.js",
        "vendor/Leaflet.fullscreen-1.0.2/Leaflet.fullscreen.js",
        "lib/jquery-ui/jquery-ui.min.js",
        "lib/jquery-fileupload/jquery.iframe-transport.js",
        "lib/jquery-fileupload/jquery.fileupload.js",

        "monkey-patching/index.js",

        "lib/schema-validator/validator.js",
        "lib/formatter/formatter.js",
        "lib/backbone-geojson/Feature.js",
        "lib/backbone-geojson/FeatureCollection.js",
        "lib/backbone-uilib/models/Domain.js",
        "lib/backbone-uilib/models/DomainCollection.js",
        "lib/backbone-uilib/views/OptionView.js",
        "lib/backbone-uilib/views/SelectView.js",
        "lib/backbone-uilib/views/SelectViewWrapper.js",
        "lib/backbone-uilib/views/WidgetsView.js",
        "lib/backbone-uilib/views/BaseView.js",
        "lib/backbone-uilib/views/ModalView.js",
        "views/common/DocxGeneratorView.js",
        "services/PrintService.js",

        "lib/backbone-dms/Config.js",
        "lib/backbone-dms/util/Util.js",
        "lib/backbone-dms/models/File.js",
        "lib/backbone-dms/models/FileCollection.js",
        "lib/backbone-dms/models/Folder.js",
        "lib/backbone-dms/models/FolderCollection.js",
        "lib/backbone-dms/models/FilePending.js",
        "lib/backbone-dms/models/FileUpload.js",
        "lib/backbone-dms/views/FileSummaryView.js",
        "lib/backbone-dms/views/FolderSummaryView.js",
        "lib/backbone-dms/views/FolderView.js",
        "lib/backbone-dms/views/FileModalView.js",
        "lib/backbone-dms/views/FileUploadView.js",
        "lib/backbone-dms/views/FileUploadingCollectionView.js",
        "lib/backbone-dms/views/FileUploadingView.js",
        "lib/backbone-dms/views/FileCollectionView.js",
        "lib/backbone-dms/views/FolderZipDownloadView.js",
        "lib/backbone-dms/views/PathFolderView.js",
        "lib/backbone-dms/views/BreadcrumbView.js",

        "Config.js",
        "views/common/CheckBoxList.js",
        "views/common/ConfigModalView.js",
        "views/show/TemplateEditTanque.js",
        "models/Estado.js",
        "models/EstadoCollection.js",
        "models/TanquePiscicola.js",
        "models/TanquePiscicolaCollection.js",
        "models/ActividadeNull.js",
        "models/ActividadeCultivo.js",
        "models/CultivoCollection.js",
        "models/Fonte.js",
        "models/FonteSchema.js",
        "models/FonteCollection.js",
        "models/HistoricoLicencias.js",
        "models/Licencia.js",
        "models/LicenciaSchema.js",
        "models/LicenciaCollection.js",
        "models/Utente.js",
        "models/UtenteSchema.js",
        "models/UtenteCollection.js",
        "models/ActividadeRes.js",
        "models/ResCollection.js",
        "models/ActividadeAbastecimento.js",
        "models/ActividadeEnergia.js",
        "models/ActividadeIndustria.js",
        "models/ActividadePecuaria.js",
        "models/ActividadePiscicultura.js",
        "models/ActividadeRegadia.js",
        "models/ActividadeSaneamento.js",
        "models/ActividadesSchema.js",
        "models/Factura.js",
        "models/FacturaCollection.js",
        "models/Exploracao.js",
        "models/ExploracaoSchema.js",
        "views/common/ModalTooltipEstadoLicenciaView.js",
        "views/common/SelectBaciaView.js",
        "views/common/SelectLocationView.js",
        "views/show/OpenFolderButtonView.js",
        "views/common/ButtonSaveView.js",
        "views/common/BlockInfoLicenseView.js",
        "views/show/ButtonDeleteView.js",
        "views/show/ButtonRefreshView.js",
        "views/common/UltimaEntregaDocModalView.js",
        "views/show/ButtonLicenciarView.js",
        "views/show/SummaryConsumoView.js",
        "views/show/SummaryLicenseView.js",
        "views/show/CEstimadoComputedView.js",
        "views/show/BlockInfoView.js",
        "views/show/BlockMapView.js",
        "views/show/LocationModalView.js",
        "views/show/BlockLocationView.js",
        "views/common/SelectUtenteView.js",
        "views/utentes/UtenteModal.js",
        "views/show/BlockUtenteView.js",
        "views/show/ModalHistoricoLicencias.js",
        "views/show/ModalViewActivity.js",
        "views/show/CultivoResModalView.js",
        "views/show/TanquePiscicolaModalView.js",
        "views/show/LicenseModalView.js",
        "views/common/RowDeleteButtonView.js",
        "views/show/FonteTableRowShowView.js",
        "views/common/TableView.js",
        "views/show/EditableTableView.js",
        "views/show/ActividadeView.js",
        "views/common/SelectActividadeView.js",
        "views/show/BlockActivityView.js",
        "views/show/BlockLicenseView.js",
        "views/show/BlockFontesView.js",
        "views/show/ExploracaoShowView.js",
        "models/Setting.js",
        "offline/MapConfig.js",
        "offline/LayerStyle.js",
        "offline/config-layers.js",
        "offline/FitToBounds.js",
        "offline/offline.js",
        "offline/LayerConfig.js",
        "utils/dynamicLoader.js",
        "MyWorkflow.js",
        "exploracao-show.js",

        output="dist/exploracao-show.js", filters="strict_mode, rjsmin" %}
        <script src="{{ ASSET_URL }}"></script>
    {% endassets %}

    {% assets
    "lib/leaflet-table/vendor/shapefile-js-3.5.0/dist/shp.js",
    "lib/leaflet-table/vendor/tmcw-togeojson-4.1.0/togeojson.umd.js",
    "lib/leaflet-table/vendor-hacked/leaflet-toolbar-0.4.0-alpha.2/leaflet.toolbar-src.js",
    "lib/leaflet-table/src/leaflet-table.js",
    "lib/leaflet-table/src/actions/addCoordinates.js",
    "lib/leaflet-table/src/actions/AddCoordinatesModalView.js",
    "lib/leaflet-table/src/actions/delete.js",
    "lib/leaflet-table/src/actions/endSession.js",
    "lib/leaflet-table/src/actions/importgpx.js",
    "lib/leaflet-table/src/actions/zoomSelected.js",
    "lib/leaflet-table/src/actions/beginEdition.js",
    "lib/leaflet-table/src/actions/endEdition.js",
    "lib/leaflet-table/src/actions/cancelEdition.js",
    "lib/leaflet-table/src/actions/GPSModalView.js",
    "lib/leaflet-table/src/editionmap.js",
    output="dist/myleaflettable.js", filters="strict_mode, rjsmin" %}
    <script src="{{ ASSET_URL }}"></script>
    {% endassets %}
{% endblock js_assets %}
